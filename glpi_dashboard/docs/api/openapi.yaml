openapi: 3.0.3
info:
  title: GLPI Dashboard API
  description: |
    API para o Dashboard GLPI - Sistema de monitoramento e métricas de tickets.
    
    Esta API fornece endpoints para:
    - Métricas de tickets (novos, pendentes, em progresso, resolvidos)
    - Ranking de técnicos
    - Alertas do sistema
    - Estatísticas de performance
    - Health checks
    
    ## Autenticação
    A API utiliza tokens de autenticação do GLPI. Configure as variáveis de ambiente:
    - `GLPI_URL`: URL do servidor GLPI
    - `GLPI_USER_TOKEN`: Token do usuário
    - `GLPI_APP_TOKEN`: Token da aplicação
    
    ## Rate Limiting
    - 100 requests por minuto por IP
    - 1000 requests por hora por token
    
    ## Cache
    - Métricas: cache de 5 minutos
    - Rankings: cache de 15 minutos
    - Status: sem cache
  version: 1.0.0
  contact:
    name: Equipe de Desenvolvimento
    email: dev@empresa.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000/api
    description: Servidor de desenvolvimento
  - url: https://glpi-dashboard.empresa.com/api
    description: Servidor de produção

paths:
  /metrics:
    get:
      summary: Obter métricas do dashboard
      description: |
        Retorna métricas completas do dashboard incluindo:
        - Contadores por status (novos, pendentes, progresso, resolvidos)
        - Métricas por nível (N1, N2, N3, N4)
        - Tendências e estatísticas
      operationId: getDashboardMetrics
      tags:
        - Métricas
      responses:
        '200':
          description: Métricas obtidas com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardMetrics'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /metrics/filtered:
    get:
      summary: Obter métricas filtradas
      description: |
        Retorna métricas filtradas por período e tipo de filtro.
        Permite análise temporal dos dados.
      operationId: getFilteredMetrics
      tags:
        - Métricas
      parameters:
        - $ref: '#/components/parameters/DataInicio'
        - $ref: '#/components/parameters/DataFim'
        - $ref: '#/components/parameters/TipoFiltro'
      responses:
        '200':
          description: Métricas filtradas do dashboard
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FilteredDashboardMetrics'
        '400':
          description: Parâmetros inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /technicians/ranking:
    get:
      summary: Obter ranking de técnicos
      description: |
        Retorna ranking de técnicos baseado em:
        - Número de tickets resolvidos
        - Performance score
        - Nível de atuação
      operationId: getTechnicianRanking
      tags:
        - Técnicos
      responses:
        '200':
          description: Ranking obtido com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TechnicianRanking'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /tickets/new:
    get:
      summary: Obter tickets novos
      description: Lista os tickets mais recentes criados no sistema
      operationId: getNewTickets
      tags:
        - Tickets
      responses:
        '200':
          description: Lista de tickets novos
          content:
            application/json:
              schema:
                type: object
                properties:
                  tickets:
                    type: array
                    items:
                      $ref: '#/components/schemas/NewTicket'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /alerts:
    get:
      summary: Obter alertas do sistema
      description: Retorna alertas ativos do sistema (SLA, performance, etc.)
      operationId: getAlerts
      tags:
        - Sistema
      responses:
        '200':
          description: Lista de alertas
          content:
            application/json:
              schema:
                type: object
                properties:
                  alerts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alert'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /performance/stats:
    get:
      summary: Obter estatísticas de performance
      description: Retorna métricas de performance da aplicação
      operationId: getPerformanceStats
      tags:
        - Sistema
      responses:
        '200':
          description: Estatísticas de performance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceStats'
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /status:
    get:
      summary: Obter status do sistema
      description: Retorna status detalhado do sistema e serviços
      operationId: getSystemStatus
      tags:
        - Sistema
      responses:
        '200':
          description: Status do sistema
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
                  data:
                    type: object
                    properties:
                      api:
                        type: string
                        enum: [online, offline]
                      glpi:
                        type: string
                        enum: [online, offline, error]
                      glpi_message:
                        type: string
                      glpi_response_time:
                        type: number
                      last_update:
                        type: string
                        format: date-time
                      version:
                        type: string
                      uptime:
                        type: string
                    required:
                      - api
                      - glpi
                      - glpi_message
                      - glpi_response_time
                      - last_update
                      - version
                      - uptime
                  overall_status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  response_time_ms:
                    type: number
                required:
                  - success
                  - data
                  - overall_status
                  - response_time_ms
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /filter-types:
    get:
      summary: Obter tipos de filtro disponíveis
      description: Retorna lista de tipos de filtro suportados pela API
      operationId: getFilterTypes
      tags:
        - Configuração
      responses:
        '200':
          description: Tipos de filtro disponíveis
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    default: true
                  data:
                    type: object
                    properties:
                      creation:
                        type: object
                        properties:
                          name:
                            type: string
                          description:
                            type: string
                          default:
                            type: boolean
                        required:
                          - name
                          - description
                          - default
                      modification:
                        type: object
                        properties:
                          name:
                            type: string
                          description:
                            type: string
                          default:
                            type: boolean
                        required:
                          - name
                          - description
                          - default
                      current_status:
                        type: object
                        properties:
                          name:
                            type: string
                          description:
                            type: string
                          default:
                            type: boolean
                        required:
                          - name
                          - description
                          - default
                    required:
                      - creation
                      - modification
                      - current_status
                  message:
                    type: string
                required:
                  - success
                  - data
                  - message
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

  /health:
    get:
      summary: Health check
      description: Endpoint para verificação de saúde da aplicação
      operationId: healthCheck
      tags:
        - Sistema
      responses:
        '200':
          description: Aplicação saudável
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
        '503':
          description: Aplicação com problemas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiError'

components:
  parameters:
    DataInicio:
      name: data_inicio
      in: query
      description: Data de início do filtro (formato YYYY-MM-DD)
      required: false
      schema:
        type: string
        format: date
        example: "2024-01-01"
    
    DataFim:
      name: data_fim
      in: query
      description: Data de fim do filtro (formato YYYY-MM-DD)
      required: false
      schema:
        type: string
        format: date
        example: "2024-01-31"
    
    TipoFiltro:
      name: tipo_filtro
      in: query
      description: Tipo de filtro a ser aplicado
      required: false
      schema:
        type: string
        enum: [creation, modification, current_status]
        default: creation
        example: creation

  schemas:
    LevelMetrics:
      type: object
      description: Métricas por nível de suporte
      properties:
        novos:
          type: integer
          description: Número de tickets novos
        pendentes:
          type: integer
          description: Número de tickets pendentes
        progresso:
          type: integer
          description: Número de tickets em progresso
        resolvidos:
          type: integer
          description: Número de tickets resolvidos
      required:
        - novos
        - pendentes
        - progresso
        - resolvidos

    NiveisMetrics:
      type: object
      description: Métricas agrupadas por nível
      properties:
        n1:
          $ref: '#/components/schemas/LevelMetrics'
        n2:
          $ref: '#/components/schemas/LevelMetrics'
        n3:
          $ref: '#/components/schemas/LevelMetrics'
        n4:
          $ref: '#/components/schemas/LevelMetrics'
      required:
        - n1
        - n2
        - n3
        - n4

    TendenciasMetrics:
      type: object
      description: Métricas de tendências
      properties:
        crescimento_semanal:
          type: number
          description: Percentual de crescimento semanal
        media_resolucao_dias:
          type: number
          description: Média de dias para resolução
        taxa_resolucao:
          type: number
          description: Taxa de resolução (%)
      required:
        - crescimento_semanal
        - media_resolucao_dias
        - taxa_resolucao

    FiltersApplied:
      type: object
      description: Filtros aplicados na consulta
      properties:
        data_inicio:
          type: string
          format: date
          nullable: true
        data_fim:
          type: string
          format: date
          nullable: true
        tipo_filtro:
          type: string
          nullable: true

    DashboardMetrics:
      type: object
      description: Métricas completas do dashboard
      properties:
        success:
          type: boolean
          default: true
        data:
          type: object
          properties:
            novos:
              type: integer
              description: Total de tickets novos
            pendentes:
              type: integer
              description: Total de tickets pendentes
            progresso:
              type: integer
              description: Total de tickets em progresso
            resolvidos:
              type: integer
              description: Total de tickets resolvidos
            total:
              type: integer
              description: Total geral de tickets
            niveis:
              type: object
              description: Métricas agrupadas por nível
              properties:
                n1:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                n2:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                n3:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                n4:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
              required:
                - n1
                - n2
                - n3
                - n4
            tendencias:
              type: object
              properties:
                novos:
                  type: string
                  description: Tendência de tickets novos
                pendentes:
                  type: string
                  description: Tendência de tickets pendentes
                progresso:
                  type: string
                  description: Tendência de tickets em progresso
                resolvidos:
                  type: string
                  description: Tendência de tickets resolvidos
              required:
                - novos
                - pendentes
                - progresso
                - resolvidos
            timestamp:
              type: string
              description: Timestamp dos dados
          required:
            - novos
            - pendentes
            - progresso
            - resolvidos
            - total
            - niveis
            - tendencias
            - timestamp
        tempo_execucao:
          type: number
          description: Tempo de execução em microssegundos
        timestamp:
          type: string
          format: date-time
          description: Timestamp da resposta
      required:
        - success
        - data
        - tempo_execucao
        - timestamp

    TechnicianRanking:
      type: object
      description: Ranking de técnicos
      properties:
        success:
          type: boolean
          default: true
        data:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                description: Nome do técnico
              total_tickets:
                type: integer
                description: Total de tickets
              resolved_tickets:
                type: integer
                description: Número de tickets resolvidos
              pending_tickets:
                type: integer
                description: Número de tickets pendentes
              avg_resolution_time:
                type: number
                description: Tempo médio de resolução
              level:
                type: string
                description: Nível de atuação
            required:
              - name
              - total_tickets
              - resolved_tickets
              - pending_tickets
              - avg_resolution_time
              - level
        correlation_id:
          type: string
          description: ID de correlação da requisição
        filters_applied:
           type: object
           properties:
             start_date:
               oneOf:
                 - type: string
                 - type: "null"
               description: Data de início do filtro
             end_date:
               oneOf:
                 - type: string
                 - type: "null"
               description: Data de fim do filtro
             level:
               oneOf:
                 - type: string
                 - type: "null"
               description: Nível filtrado
             limit:
               type: integer
               description: Limite de resultados
        message:
          type: string
          description: Mensagem quando não há dados
      required:
        - success
        - data
        - correlation_id
        - filters_applied

    NewTicket:
      type: object
      description: Ticket novo
      properties:
        id:
          type: integer
          description: ID do ticket
        title:
          type: string
          description: Título do ticket
        description:
          type: string
          description: Descrição do ticket
        date:
          type: string
          format: date-time
          description: Data de criação
        requester:
          type: string
          description: Solicitante
        priority:
          type: string
          description: Prioridade
        status:
          type: string
          default: "Novo"
          description: Status do ticket
      required:
        - id
        - title
        - description
        - date
        - requester
        - priority
        - status

    Alert:
      type: object
      description: Alerta do sistema
      properties:
        id:
          type: string
          description: ID do alerta
        type:
          type: string
          enum: [sla, performance, system, warning, error]
          description: Tipo do alerta
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Severidade do alerta
        message:
          type: string
          description: Mensagem do alerta
        timestamp:
          type: string
          format: date-time
          description: Timestamp do alerta
        resolved:
          type: boolean
          default: false
          description: Se o alerta foi resolvido
      required:
        - id
        - type
        - severity
        - message
        - timestamp
        - resolved

    PerformanceStats:
      type: object
      description: Estatísticas de performance
      properties:
        success:
          type: boolean
          default: true
        data:
          type: object
          properties:
            avg_response_time:
              type: number
              description: Tempo médio de resposta (ms)
            p95_response_time:
              type: number
              description: Percentil 95 do tempo de resposta (ms)
            cache_hit_rate:
              type: number
              description: Taxa de acerto do cache
            cache_hits:
              type: integer
              description: Número de cache hits
            cache_misses:
              type: integer
              description: Número de cache misses
            cache_timeout:
              type: integer
              description: Timeout do cache em segundos
            cache_type:
              type: string
              description: Tipo de cache utilizado
            target_p95_ms:
              type: integer
              description: Meta para percentil 95 em ms
            total_requests:
              type: integer
              description: Total de requisições processadas
          required:
            - avg_response_time
            - p95_response_time
            - cache_hit_rate
            - cache_hits
            - cache_misses
            - cache_timeout
            - cache_type
            - target_p95_ms
            - total_requests
      required:
        - success
        - data

    SystemStatus:
      type: object
      description: Status do sistema
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
          description: Status geral do sistema
        glpi_connection:
          type: object
          properties:
            status:
              type: string
              enum: [connected, disconnected, error]
            last_check:
              type: string
              format: date-time
            response_time_ms:
              type: number
        cache_status:
          type: object
          properties:
            status:
              type: string
              enum: [available, unavailable]
            hit_rate:
              type: number
            total_keys:
              type: integer
        services:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              status:
                type: string
                enum: [running, stopped, error]
              last_check:
                type: string
                format: date-time
        version:
          type: string
          description: Versão da aplicação
        environment:
          type: string
          description: Ambiente (development, production, etc.)
      required:
        - status
        - glpi_connection
        - cache_status
        - services
        - version
        - environment

    FilteredDashboardMetrics:
      type: object
      description: Schema para métricas filtradas do dashboard
      properties:
        success:
          type: boolean
          description: Status da operação
        correlation_id:
          type: string
          description: ID de correlação da requisição
        data:
          type: object
          properties:
            novos:
              type: integer
              description: Total de tickets novos
            pendentes:
              type: integer
              description: Total de tickets pendentes
            progresso:
              type: integer
              description: Total de tickets em progresso
            resolvidos:
              type: integer
              description: Total de tickets resolvidos
            total:
              type: integer
              description: Total geral de tickets
            niveis:
              type: object
              description: Métricas agrupadas por nível
              properties:
                geral:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                    total:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                    - total
                n1:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                    total:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                    - total
                n2:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                    total:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                    - total
                n3:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                    total:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                    - total
                n4:
                  type: object
                  properties:
                    novos:
                      type: integer
                    pendentes:
                      type: integer
                    progresso:
                      type: integer
                    resolvidos:
                      type: integer
                    total:
                      type: integer
                  required:
                    - novos
                    - pendentes
                    - progresso
                    - resolvidos
                    - total
              required:
                - geral
                - n1
                - n2
                - n3
                - n4
            tendencias:
              type: object
              properties:
                novos_hoje:
                  type: integer
                  description: Novos tickets hoje
                pendencias_ontem:
                  type: integer
                  description: Pendências de ontem
                resolvidos_hoje:
                  type: integer
                  description: Tickets resolvidos hoje
                variacao_pendentes:
                  type: integer
                  description: Variação de pendentes
              required:
                - novos_hoje
                - pendencias_ontem
                - resolvidos_hoje
                - variacao_pendentes
            filters_applied:
               type: object
               properties:
                 start_date:
                   type: [string, "null"]
                   description: Data de início do filtro
                 end_date:
                   type: [string, "null"]
                   description: Data de fim do filtro
                 status:
                   type: [string, "null"]
                   description: Status filtrado
                 priority:
                   type: [string, "null"]
                   description: Prioridade filtrada
                 level:
                   type: [string, "null"]
                   description: Nível filtrado
                 technician:
                   type: [string, "null"]
                   description: Técnico filtrado
                 category:
                   type: [string, "null"]
                   description: Categoria filtrada
            timestamp:
              type: string
              description: Timestamp dos dados
          required:
            - novos
            - pendentes
            - progresso
            - resolvidos
            - total
            - niveis
            - tendencias
            - filters_applied
            - timestamp
        tempo_execucao:
          type: number
          description: Tempo de execução em milissegundos
      required:
        - success
        - correlation_id
        - data
        - tempo_execucao

    ApiError:
      type: object
      description: Schema para erros da API
      properties:
        success:
          type: boolean
          default: false
          description: Sempre false para erros
        message:
          type: string
          description: Mensagem de erro
        errors:
          type: array
          items:
            type: string
          description: Lista detalhada de erros
        timestamp:
          type: string
          format: date-time
          description: Timestamp do erro
        error_code:
          type: string
          nullable: true
          description: Código de erro específico
      required:
        - success
        - message
        - errors
        - timestamp

tags:
  - name: Métricas
    description: Endpoints relacionados a métricas e estatísticas de tickets
  - name: Técnicos
    description: Endpoints relacionados a técnicos e rankings
  - name: Tickets
    description: Endpoints relacionados a tickets
  - name: Sistema
    description: Endpoints de sistema, monitoramento e health checks
  - name: Configuração
    description: Endpoints de configuração e metadados

externalDocs:
  description: Documentação completa do GLPI Dashboard
  url: https://docs.glpi-dashboard.com