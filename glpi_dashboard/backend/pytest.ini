[tool:pytest]
# Configuração do pytest para o backend

# Diretórios de teste
testpaths = tests

# Padrões de arquivos de teste
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Marcadores personalizados
markers =
    unit: marca testes unitários
    integration: marca testes de integração
    performance: marca testes de performance
    load: marca testes de carga
    security: marca testes de segurança
    slow: marca testes que demoram para executar
    fast: marca testes rápidos
    api: marca testes de API
    database: marca testes que usam banco de dados
    external: marca testes que dependem de serviços externos
    smoke: marca testes de smoke
    regression: marca testes de regressão
    critical: marca testes críticos
    skip_ci: marca testes para pular no CI
    windows_only: marca testes que só rodam no Windows
    linux_only: marca testes que só rodam no Linux
    requires_network: marca testes que precisam de rede
    requires_auth: marca testes que precisam de autenticação

# Opções padrão
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=.
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-report=term-missing
    --cov-report=json:coverage.json
    --cov-fail-under=80
    --cov-branch
    --junitxml=test-results/junit.xml
    --html=test-results/report.html
    --self-contained-html
    --maxfail=5
    --durations=10
    --capture=no
    --log-cli=true
    --log-cli-level=INFO
    --log-cli-format=%(asctime)s [%(levelname)8s] %(name)s: %(message)s
    --log-cli-date-format=%Y-%m-%d %H:%M:%S
    --log-file=test-results/pytest.log
    --log-file-level=DEBUG
    --log-file-format=%(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d %(funcName)s(): %(message)s
    --log-file-date-format=%Y-%m-%d %H:%M:%S
    --disable-warnings
    --color=yes

# Configuração de timeout
timeout = 300
timeout_method = thread

# Configuração de cache
cache_dir = .pytest_cache

# Configuração de cobertura
cov_config = .coveragerc

# Configuração de filtros de warning
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ImportWarning
    ignore::ResourceWarning
    error::pytest.PytestUnraisableExceptionWarning

# Configuração de minimum version
minversion = 6.0

# Configuração de required plugins
required_plugins =
    pytest-cov>=4.0.0
    pytest-html>=3.1.0
    pytest-xdist>=3.0.0
    pytest-mock>=3.10.0
    pytest-asyncio>=0.21.0
    pytest-timeout>=2.1.0
    pytest-benchmark>=4.0.0
    pytest-env>=0.8.0
    pytest-randomly>=3.12.0

# Configuração de console output style
console_output_style = progress

# Configuração de empty parameter sets
empty_parameter_set_mark = skip

# Configuração de faulthandler
faulthandler_timeout = 300

# Configuração de junit
junit_suite_name = backend_tests
junit_logging = all
junit_log_passing_tests = true
junit_duration_report = total
junit_family = xunit2

# Configuração de live logging
log_auto_indent = true
log_capture = true
log_level = INFO
log_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_date_format = %Y-%m-%d %H:%M:%S

# Configuração de tmp path
tmp_path_retention_count = 3
tmp_path_retention_policy = failed

# Configuração de xfail
xfail_strict = false

# Configuração de asyncio
asyncio_mode = auto

# Configuração de benchmark
benchmark_only = false
benchmark_sort = mean
benchmark_compare_fail = mean:5%
benchmark_warmup = true
benchmark_warmup_iterations = 100000
benchmark_disable_gc = true
benchmark_min_rounds = 5
benchmark_max_time = 1.0
benchmark_min_time = 0.000005
benchmark_timer = time.perf_counter
benchmark_cprofile_top = 20
benchmark_cprofile_sort = cumulative

# Configuração de randomly
randomly_seed = 12345
randomly_dont_shuffle = doctest
randomly_dont_reorganize = false

# Configuração de env
env =
    TESTING = true
    ENVIRONMENT = test
    LOG_LEVEL = DEBUG
    DATABASE_URL = sqlite:///test.db
    REDIS_URL = redis://localhost:6379/1
    SECRET_KEY = test-secret-key-for-testing-only
    DEBUG = true
    PYTHONPATH = .
